<!DOCTYPE html>
<html lang="tr" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>FieldOps Pro - Stratejik Operasyon Sistemi</title>

    <!-- External Scripts (CDNs) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap"
        rel="stylesheet">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: { dark: '#020617', card: '#0f172a' },
                    fontFamily: { sans: ['Inter', 'sans-serif'] }
                }
            }
        }
    </script>
    <style>
        body {
            -webkit-tap-highlight-color: transparent;
            font-family: 'Inter', sans-serif;
            background-color: #020617;
            color: #f8fafc;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }

        .glass-card {
            background: rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .safe-area-bottom {
            padding-bottom: env(safe-area-inset-bottom);
        }

        select {
            -webkit-appearance: none;
            appearance: none;
        }

        ::-webkit-scrollbar {
            width: 0;
            background: transparent;
        }

        #loading {
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #020617;
            z-index: 1000;
            transition: opacity 0.5s;
        }

        .custom-range {
            -webkit-appearance: none;
            height: 6px;
            background: #1e293b;
            border-radius: 5px;
            outline: none;
        }

        .custom-range::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: #3b82f6;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid #020617;
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
        }

        @keyframes pulse-slow {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.6;
            }
        }

        .animate-pulse-slow {
            animation: pulse-slow 3s infinite;
        }
    </style>
</head>

<body class="text-slate-100 min-h-screen">
    <div id="loading">
        <div class="flex flex-col items-center gap-6">
            <div class="relative">
                <div class="w-16 h-16 border-4 border-blue-600/20 rounded-full"></div>
                <div
                    class="absolute inset-0 w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin">
                </div>
            </div>
            <div class="flex flex-col items-center">
                <h1 class="font-black text-xl italic uppercase font-black tracking-tighter">FieldOps <span
                        class="text-blue-500">Pro</span></h1>
                <p class="text-[9px] text-slate-500 font-black uppercase tracking-[0.4em] mt-1">Sistem HazÄ±rlanÄ±yor</p>
            </div>
        </div>
    </div>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- STRATEGIC CONSTANTS ---
        const MAHALLE_PRIORITY = ["GÃœMÃœÅžPALA", "DENÄ°ZKÃ–ÅžKLER", "AMBARLI", "MERKEZ", "CÄ°HANGÄ°R"];
        const TIMESLOT_ORDER = ["10/12", "12/14", "14/16", "16/18"];

        // --- UTILS ---
        const normalizePhone = (p) => {
            if (!p) return '';
            let c = p.replace(/\D/g, '');
            if (c.length === 10) return '90' + c;
            if (c.length === 11 && c.startsWith('0')) return '9' + c;
            return c;
        };

        const getActiveSlot = () => {
            const h = new Date().getHours();
            if (h < 12) return "10/12"; if (h < 14) return "12/14"; if (h < 16) return "14/16"; return "16/18";
        };

        const calculateScore = (s) => {
            const active = getActiveSlot();
            const aIdx = TIMESLOT_ORDER.indexOf(active), sIdx = TIMESLOT_ORDER.indexOf(s.timeSlot);
            let score = 0;
            if (sIdx === aIdx) score += 1000;
            else if (sIdx < aIdx) score += 500;
            else score += (100 - (sIdx - aIdx) * 20);
            const mName = s.mahalle.toUpperCase().trim(), mIdx = MAHALLE_PRIORITY.indexOf(mName);
            if (mIdx !== -1) score += (MAHALLE_PRIORITY.length - mIdx) * 10;
            return score;
        };

        const Icon = ({ name, size = 20, className = "" }) => {
            useEffect(() => { if (window.lucide) window.lucide.createIcons(); }, [name]);
            return <i data-lucide={name} className={className} style={{ width: size, height: size, display: 'inline-block', strokeWidth: 2 }} />;
        };

        // --- STORE HOOK ---
        const useAppStore = () => {
            const [services, setServices] = useState(() => JSON.parse(localStorage.getItem('fop-v4-srv') || '[]'));
            const [archive, setArchive] = useState(() => JSON.parse(localStorage.getItem('fop-v4-arc') || '[]'));
            const [locked, setLocked] = useState(() => JSON.parse(localStorage.getItem('fop-v4-lck') || 'false'));

            useEffect(() => localStorage.setItem('fop-v4-srv', JSON.stringify(services)), [services]);
            useEffect(() => localStorage.setItem('fop-v4-arc', JSON.stringify(archive)), [archive]);
            useEffect(() => localStorage.setItem('fop-v4-lck', JSON.stringify(locked)), [locked]);

            const addJob = (data) => {
                const phone = normalizePhone(data.phone);
                const history = [...services, ...archive].filter(s => normalizePhone(s.phone) === phone).sort((a, b) => b.createdAt - a.createdAt);
                const job = {
                    ...data, id: Math.random().toString(36).substr(2, 9), phone, status: 'pending', createdAt: Date.now(),
                    plus: false, aksesuar: false, bakim: false, nps: null, cancelReason: '', isExtra: locked
                };
                setServices(prev => [job, ...prev]);
                return history[0] || null;
            };

            const updateJob = (id, up) => setServices(prev => prev.map(s => s.id === id ? { ...s, ...up } : s));
            const toggle = (id, st) => setServices(prev => prev.map(s => s.id === id ? { ...s, status: s.status === st ? 'pending' : st } : s));

            const stats = (list = services) => list.reduce((acc, s) => {
                const total = list.length;
                if (s.status === 'done') {
                    acc.done++; let p = 25, c = 200;
                    if (s.plus) { p += 130; c += 500; } if (s.aksesuar) { p += 100; c += 350; } if (s.bakim) { p += 250; c += 850; acc.bakims++; }
                    acc.prime += p; acc.ciro += c; if (s.plus || s.aksesuar || s.bakim) acc.sales++;
                } else if (s.status === 'cancelled') acc.cancels++;
                acc.saleRate = acc.done > 0 ? Math.round((acc.sales / acc.done) * 100) : 0;
                acc.avg = acc.done > 0 ? Math.round(acc.prime / acc.done) : 0;
                acc.cancelRate = total > 0 ? Math.round((acc.cancels / total) * 100) : 0;
                acc.bakimRate = acc.done > 0 ? Math.round((acc.bakims / acc.done) * 100) : 0;
                acc.pending = list.filter(x => x.status === 'pending').length;
                acc.progress = (acc.done + acc.pending) > 0 ? Math.round((acc.done / (acc.done + acc.pending)) * 100) : 0;
                return acc;
            }, { done: 0, cancels: 0, prime: 0, ciro: 0, sales: 0, bakims: 0, pending: 0, progress: 0 });

            return { services, archive, locked, setLocked, addJob, updateJob, toggle, stats };
        };

        // --- COMPONENTS ---
        const MessageModal = ({ s, onClose }) => {
            const temps = [
                { id: 'door', name: 'ðŸšª KapÄ±dayÄ±m', icon: 'door-open', clr: 'text-emerald-400', txt: `Merhaba, Ben Bosch Siemens yetkili servisinden Emrehan. Åžu an kapÄ±nÄ±zdayÄ±m. MÃ¼saitliÄŸiniz varsa zili Ã§alÄ±yorum.` },
                { id: 'arr', name: 'VarÄ±ÅŸ / Teyit', icon: 'clock', clr: 'text-blue-400', txt: `Merhaba,\nBen Emrehan, Bosch Siemens Profilo yetkili servisinden ulaÅŸÄ±yorum.\n\nBugÃ¼n ${s.timeSlot} saat aralÄ±ÄŸÄ±nda ${s.mahalle} ${s.address} adresiniz iÃ§in servis kaydÄ±nÄ±z bulunmaktadÄ±r.\n\nÅžu an bÃ¶lgenizdeyiz. UygunsanÄ±z geÃ§mek isteriz. Teyit edebilir misiniz?` },
                { id: 'del', name: 'Gecikme Bilgisi', icon: 'alert-triangle', clr: 'text-amber-400', txt: `Merhaba,\nEmrehan ben, Bosch Siemens yetkili servisinden.\n\nYoÄŸunluk nedeniyle kÄ±sa bir gecikme yaÅŸanmaktadÄ±r. En geÃ§ 30 dakika iÃ§erisinde ${s.mahalle} adresinizde olacaÄŸÄ±z.` },
                { id: 'post', name: 'ðŸ“… YarÄ±n Erteleme', icon: 'calendar-days', clr: 'text-rose-400', txt: `Merhaba,\nBosch Siemens yetkili servisinden ulaÅŸÄ±yorum.\n\nBugÃ¼n bÃ¶lgedeki yoÄŸunluk nedeniyle size geÃ§iÅŸ yapÄ±lamayacaktÄ±r. YarÄ±n gÃ¼n iÃ§erisinde gelmeden 10-15dk Ã¶ncesinde sizi arayacaÄŸÄ±z.\n\nAnlayÄ±ÅŸÄ±nÄ±z iÃ§in teÅŸekkÃ¼r ederiz.` }
            ];
            const send = (txt) => { window.open(`https://wa.me/${s.phone}?text=${encodeURIComponent(txt)}`, '_blank'); onClose(); };
            return (
                <div className="fixed inset-0 z-[200] flex items-end md:items-center justify-center p-4 bg-black/70 backdrop-blur-sm">
                    <div className="w-full max-w-sm bg-slate-950 border border-white/10 rounded-[2.5rem] shadow-2xl p-6">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="font-black italic uppercase text-lg">Ä°letiÅŸim <span className="text-blue-500">ZekasÄ±</span></h2>
                            <button onClick={onClose} className="p-2 bg-slate-900 rounded-xl"><Icon name="x" size={18} /></button>
                        </div>
                        <div className="space-y-3 max-h-[50vh] overflow-y-auto">
                            {temps.map(t => (
                                <button key={t.id} onClick={() => send(t.txt)} className="w-full bg-slate-900/50 p-4 rounded-3xl text-left border border-white/5 active:scale-95 transition-all group">
                                    <div className="flex items-center gap-2 mb-2"><Icon name={t.icon} size={16} className={t.clr} /><span className="text-[10px] font-black uppercase text-slate-300">{t.name}</span></div>
                                    <p className="text-[10px] text-slate-500 italic line-clamp-2 leading-relaxed">"{t.txt}"</p>
                                </button>
                            ))}
                        </div>
                    </div>
                </div>
            )
        };

        const Card = ({ s, update, toggle }) => {
            const [m, setM] = useState(false);
            const active = getActiveSlot();
            const delay = s.status === 'pending' && TIMESLOT_ORDER.indexOf(s.timeSlot) < TIMESLOT_ORDER.indexOf(active);
            const isAct = s.timeSlot === active;
            const bdr = s.status === 'done' ? 'border-emerald-500/30' : s.status === 'cancelled' ? 'border-rose-500/30' : delay ? 'border-rose-500/40 bg-rose-500/5' : isAct ? 'border-amber-500/40 bg-amber-500/5' : 'border-white/5';

            const sendDoor = () => {
                const txt = `Merhaba, Ben Bosch Siemens yetkili servisinden Emrehan. Åžu an kapÄ±nÄ±zdayÄ±m. MÃ¼saitliÄŸiniz varsa zili Ã§alÄ±yorum.`;
                window.open(`https://wa.me/${s.phone}?text=${encodeURIComponent(txt)}`, '_blank');
            };

            return (
                <div className={`p-5 rounded-[2.5rem] border-2 mb-4 transition-all relative glass-card ${bdr}`}>
                    {delay && <div className="absolute -right-1 -top-2 bg-rose-600 px-3 py-1 rounded-full text-[9px] font-black animate-pulse">GECÄ°KMÄ°Åž</div>}
                    {!delay && isAct && <div className="absolute -right-1 -top-2 bg-amber-600 px-3 py-1 rounded-full text-[9px] font-black tracking-widest">AKTÄ°F SAAT</div>}
                    <div className="flex justify-between items-start mb-4">
                        <div>
                            <div className="flex items-center gap-2">
                                <h3 className="font-black text-lg uppercase italic tracking-tighter">{s.name}</h3>
                                <span className={`text-[8px] font-black px-2 py-0.5 rounded-full ${s.isExtra ? 'bg-blue-600/20 text-blue-400 border border-blue-500/20' : 'bg-slate-800 text-slate-500'}`}>{s.isExtra ? 'EKSTRA' : 'PLANLI'}</span>
                            </div>
                            <p className="text-[10px] text-slate-500 font-black uppercase tracking-widest leading-none mt-1">{s.timeSlot} â€¢ {s.phone}</p>
                        </div>
                        <div className="flex gap-1.5">
                            <button onClick={sendDoor} title="KapÄ±dayÄ±m" className="w-10 h-10 bg-rose-600 rounded-2xl flex items-center justify-center shadow-lg active:scale-95 transition-all"><Icon name="door-open" size={18} /></button>
                            <button onClick={() => window.location.href = `tel:${s.phone}`} className="w-10 h-10 bg-amber-500 rounded-2xl flex items-center justify-center shadow-lg active:scale-95 transition-all"><Icon name="phone" size={18} /></button>
                            <button onClick={() => window.open(`https://www.google.com/maps/dir/?api=1&origin=My+Location&destination=${encodeURIComponent(s.address)}`, '_blank')} className="w-10 h-10 bg-blue-600 rounded-2xl flex items-center justify-center shadow-lg active:scale-95 transition-all"><Icon name="map-pin" size={18} /></button>
                            <button onClick={() => setM(true)} className="w-10 h-10 bg-emerald-600 rounded-2xl flex items-center justify-center shadow-lg active:scale-95 transition-all"><Icon name="message-square" size={18} /></button>
                        </div>
                    </div>
                    {s.notes && <p className="text-[11px] text-slate-500 italic mb-4 p-3 bg-black/20 rounded-2xl border border-white/5 leading-relaxed">"{s.notes}"</p>}
                    <div className="flex flex-wrap gap-1.5 mb-5">
                        {['plus', 'aksesuar', 'bakim'].map(t => (
                            <button key={t} onClick={() => update(s.id, { [t]: !s[t] })} className={`px-3 py-2 rounded-full border text-[9px] font-black transition-all ${s[t] ? 'bg-blue-600 border-blue-500 text-white' : 'bg-slate-950 border-white/5 text-slate-700'}`}>{t === 'plus' ? '+PLUS' : t.toUpperCase()}</button>
                        ))}
                    </div>
                    {s.status === 'done' && (
                        <div className="mb-5 bg-slate-950/50 p-3 rounded-2xl border border-white/5">
                            <div className="flex justify-between items-center mb-1"><span className="text-[8px] font-black text-slate-600 flex items-center gap-1 uppercase"><Icon name="star" size={10} className="fill-blue-500" /> NPS PuanÄ±</span><span className="text-blue-400 font-black text-xs">{s.nps ?? '-'}</span></div>
                            <input type="range" min="0" max="10" className="custom-range w-full" value={s.nps || 0} onChange={e => update(s.id, { nps: parseInt(e.target.value) })} />
                        </div>
                    )}
                    <div className="flex gap-2">
                        <button onClick={() => toggle(s.id, 'done')} className={`flex-1 p-4 rounded-2xl text-[10px] font-black transition-all ${s.status === 'done' ? 'bg-emerald-600 shadow-xl shadow-emerald-900/20' : 'bg-slate-950 border border-white/5 text-slate-600'}`}>TAMAMLA</button>
                        <button onClick={() => toggle(s.id, 'cancelled')} className={`flex-1 p-4 rounded-2xl text-[10px] font-black transition-all ${s.status === 'cancelled' ? 'bg-rose-600 shadow-xl shadow-rose-900/20' : 'bg-slate-950 border border-white/5 text-slate-600'}`}>Ä°PTAL</button>
                    </div>
                    {m && <MessageModal s={s} onClose={() => setM(false)} />}
                </div>
            )
        };

        const App = () => {
            const [view, setView] = useState('home');
            const { services, archive, locked, setLocked, addJob, updateJob, toggle, stats } = useAppStore();
            const [hist, setHist] = useState(null);
            const [form, setForm] = useState({ name: '', phone: '', mahalle: '', timeSlot: '10/12', address: '', notes: '' });
            const [search, setSearch] = useState('');

            useEffect(() => { setTimeout(() => document.getElementById('loading').style.opacity = '0', 500); setTimeout(() => document.getElementById('loading').remove(), 1000); }, []);

            const cur = stats();
            const filtered = useMemo(() => {
                let list = [...services].sort((a, b) => {
                    if (a.status === 'pending' && b.status !== 'pending') return -1; if (a.status !== 'pending' && b.status === 'pending') return 1;
                    return calculateScore(b) - calculateScore(a);
                });
                if (!search) return list;
                const t = search.toLowerCase();
                return list.filter(x => x.name.toLowerCase().includes(t) || x.phone.includes(t) || x.mahalle.toLowerCase().includes(t));
            }, [services, search]);

            const planned = filtered.filter(s => !s.isExtra && s.status === 'pending');
            const extras = filtered.filter(s => s.isExtra && s.status === 'pending');
            const done = filtered.filter(s => s.status !== 'pending');
            const best = filtered.find(s => s.status === 'pending');

            const tac = () => {
                if (cur.done >= 5 && cur.saleRate < 20) return "âš  5 iÅŸte satÄ±ÅŸ yok! BakÄ±m satÄ±ÅŸÄ±na odaklan.";
                if (cur.bakimRate > 40) return "ðŸ† Efsane bakÄ±m baÅŸarÄ±sÄ±! StandartlarÄ± yÃ¼kseltiyoruz.";
                if (cur.saleRate > 60) return "ðŸ”¥ SatÄ±ÅŸ zekasÄ± zirvede! Hizmet kalitesini (NPS) koru.";
                return "ðŸ’¡ BugÃ¼n mahalle potansiyeli yÃ¼ksek. Ek satÄ±ÅŸ zorla.";
            };

            return (
                <div className="pb-24 max-w-xl mx-auto">
                    <header className="sticky top-0 z-50 h-20 glass-card px-4 flex items-center justify-between border-b border-white/5">
                        <div className="flex items-center gap-3">
                            <div className="w-10 h-10 rounded-2xl bg-blue-600 flex items-center justify-center shadow-xl shadow-blue-600/30"><span className="font-black text-xl italic">F</span></div>
                            <div><h1 className="font-black text-lg tracking-tighter leading-none italic uppercase">FieldOps <span className="text-blue-500">Pro</span></h1><p className="text-[8px] font-black text-slate-500 uppercase tracking-widest mt-1">Strategic</p></div>
                        </div>
                        <div className="flex gap-2">
                            <button onClick={() => setLocked(!locked)} className={`p-2.5 rounded-xl border ${locked ? 'bg-amber-600/20 border-amber-500/30 text-amber-500' : 'bg-slate-900 border-slate-800 text-slate-600'}`}><Icon name={locked ? 'lock' : 'unlock'} size={20} /></button>
                            <nav className="flex gap-1 bg-slate-950 p-1 rounded-2xl border border-white/5">
                                <button onClick={() => setView('home')} className={`p-2 rounded-xl ${view === 'home' ? 'bg-blue-600' : 'text-slate-600'}`}><Icon name="layout-dashboard" size={20} /></button>
                                <button onClick={() => setView('archive')} className={`p-2 rounded-xl ${view === 'archive' ? 'bg-slate-800' : 'text-slate-600'}`}><Icon name="bar-chart-3" size={20} /></button>
                            </nav>
                        </div>
                    </header>

                    <main className="p-4">
                        {view === 'home' ? (
                            <>
                                <div className="glass-card p-5 rounded-[2.5rem] border-blue-500/20 mb-4 shadow-xl shadow-blue-900/10">
                                    <div className="flex justify-between items-end mb-3">
                                        <div className="flex items-center gap-2">
                                            <div className="w-8 h-8 rounded-xl bg-emerald-500/10 flex items-center justify-center text-emerald-500"><Icon name="check-circle-2" size={18} /></div>
                                            <div><p className="text-[10px] font-black text-slate-600 uppercase tracking-widest leading-none mb-1">Rota Ä°lerlemesi</p><h3 className="text-sm font-black text-slate-100 italic uppercase">GÃ¼nÃ¼n %{cur.progress} TamamlandÄ±</h3></div>
                                        </div>
                                        <span className="text-[11px] font-black text-blue-500 uppercase">Ä°ÅŸ: {cur.done}/{cur.done + cur.pending}</span>
                                    </div>
                                    <div className="w-full h-3 bg-slate-950 rounded-full border border-white/5 p-0.5"><div className="h-full bg-gradient-to-r from-emerald-500 to-blue-600 rounded-full transition-all duration-1000" style={{ width: `${cur.progress}%` }}></div></div>
                                </div>

                                <div className="grid grid-cols-4 gap-2 mb-6">
                                    {[['SatÄ±ÅŸ', cur.saleRate + '%', 'trending-up', 'blue'], ['Prim', cur.avg + 'â‚º', 'zap', 'emerald'], ['Ä°ptal', cur.cancelRate + '%', 'ban', 'rose'], ['BakÄ±m', cur.bakimRate + '%', 'award', 'amber']].map(x => (
                                        <div key={x[0]} className="glass-card p-3 rounded-3xl border-white/5">
                                            <p className="text-[8px] font-black text-slate-600 uppercase tracking-widest mb-1 text-center">{x[0]}</p>
                                            <div className="flex flex-col items-center gap-1"><span className="text-sm font-black">{x[1]}</span><Icon name={x[2]} size={12} className={`text-${x[3]}-500`} /></div>
                                        </div>
                                    ))}
                                </div>

                                <div className="glass-card p-4 rounded-3xl mb-4 flex items-center gap-3 border-blue-500/20">
                                    <div className="w-1 h-6 bg-blue-600 rounded-full animate-pulse"></div>
                                    <p className="text-[10px] font-black text-slate-300 uppercase italic leading-none">TAKTÄ°K: <span className="text-blue-500">{tac()}</span></p>
                                </div>

                                <div className="relative mb-8">
                                    <div className="absolute left-5 top-1/2 -translate-y-1/2 text-slate-500"><Icon name="search" size={20} /></div>
                                    <input className="w-full bg-slate-950 border-2 border-slate-900 focus:border-blue-600/50 rounded-[2rem] py-4 pl-14 pr-12 focus:outline-none text-sm font-bold shadow-2xl transition-all" placeholder="HÄ±zlÄ± ara..." value={search} onChange={e => setSearch(e.target.value)} />
                                    {search && <button onClick={() => setSearch('')} className="absolute right-5 top-1/2 -translate-y-1/2 text-slate-500"><Icon name="x" size={20} /></button>}
                                </div>

                                <div className="relative">
                                    <div className={`glass-card p-6 rounded-[2.5rem] mb-10 border-2 transition-all ${locked ? 'border-amber-500/20' : 'border-blue-500/10'}`}>
                                        <div className="flex justify-between items-center mb-6"> <h2 className="font-black text-xs uppercase italic flex items-center gap-2"><Icon name="plus-circle" className="text-blue-600" /> Servis GiriÅŸi</h2> {locked && <span className="bg-amber-600/20 text-amber-500 text-[8px] font-black px-3 py-1 rounded-full border border-amber-500/20">EKSTRA MODU</span>}</div>
                                        <form className="space-y-3" onSubmit={e => {
                                            e.preventDefault(); const r = addJob(form); if (r) { setHist(r); setTimeout(() => setHist(null), 7000); }
                                            setForm({ name: '', phone: '', mahalle: '', timeSlot: '10/12', address: '', notes: '' });
                                        }}>
                                            <div className="grid grid-cols-2 gap-2"><input className="w-full bg-slate-950 p-4 border border-white/5 rounded-2xl text-[13px] font-bold" placeholder="MÃ¼ÅŸteri" value={form.name} onChange={e => setForm({ ...form, name: e.target.value })} required /><input className="w-full bg-slate-950 p-4 border border-white/5 rounded-2xl text-[13px] font-bold" placeholder="Tel" value={form.phone} onChange={e => setForm({ ...form, phone: e.target.value })} required /></div>
                                            <div className="grid grid-cols-2 gap-2"><input className="w-full bg-slate-950 p-4 border border-white/5 rounded-2xl text-[13px] font-bold" placeholder="Mahalle" value={form.mahalle} onChange={e => setForm({ ...form, mahalle: e.target.value })} required /><select className="w-full bg-slate-950 p-4 border border-white/5 rounded-2xl text-[13px] font-bold" value={form.timeSlot} onChange={e => setForm({ ...form, timeSlot: e.target.value })}>{TIMESLOT_ORDER.map(t => <option key={t}>{t}</option>)}</select></div>
                                            <input className="w-full bg-slate-950 p-4 border border-white/5 rounded-2xl text-[13px] font-bold" placeholder="AÃ§Ä±k Adres" value={form.address} onChange={e => setForm({ ...form, address: e.target.value })} required />
                                            <textarea className="w-full bg-slate-950 p-4 border border-white/5 rounded-2xl text-[11px] font-bold resize-none h-20" placeholder="Stratejik Notlar..." value={form.notes} onChange={e => setForm({ ...form, notes: e.target.value })} />
                                            <button className="w-full bg-blue-600 font-black p-4 rounded-2xl text-xs tracking-widest active:scale-95 transition-all shadow-xl shadow-blue-900/20">SÄ°STEMÄ° GÃœNCELLE</button>
                                        </form>
                                    </div>
                                    {hist && (
                                        <div className="absolute -top-6 w-full z-[100] p-4 bg-amber-500 rounded-3xl shadow-2xl flex items-center gap-4 text-slate-950">
                                            <Icon name="history" size={24} />
                                            <div className="text-[10px] font-black uppercase">Son Ziyaret: {new Date(hist.createdAt).toLocaleDateString()} â€¢ {hist.status === 'done' ? 'TAMAM' : 'Ä°PTAL'} â€¢ {hist.bakim ? 'BAKIM VAR' : ''}</div>
                                        </div>
                                    )}
                                </div>

                                {best && !search && (
                                    <div onClick={() => window.open(`https://www.google.com/maps/dir/?api=1&origin=My+Location&destination=${encodeURIComponent(best.address)}`, '_blank')} className="bg-slate-900 border-2 border-blue-500/20 p-5 rounded-[2.5rem] mb-12 flex items-center justify-between shadow-2xl cursor-pointer active:scale-95 transition-all">
                                        <div className="flex gap-4 items-center">
                                            <div className="w-14 h-14 bg-blue-600 rounded-3xl flex items-center justify-center shadow-lg transform rotate-3"><Icon name="navigation" size={32} /></div>
                                            <div><p className="text-[8px] font-black text-blue-500 uppercase tracking-widest mb-1">EN YAKIN Ã–NCELÄ°KLÄ° Ä°Åž</p><h3 className="font-black text-xl italic leading-none">{best.name}</h3><p className="text-[9px] text-slate-600 font-bold uppercase mt-1">{best.mahalle} â€¢ {best.timeSlot}</p></div>
                                        </div>
                                        <Icon name="zap" className="text-blue-500 animate-pulse" />
                                    </div>
                                )}

                                <div className="space-y-12">
                                    {[
                                        { l: 'Planlananlar', c: planned, clr: 'blue' }, { l: 'Ekstra Ã‡aÄŸrÄ±lar', c: extras, clr: 'amber' }, { l: 'Biten / Ä°ptal', c: done, clr: 'slate' }
                                    ].map(sec => sec.c.length > 0 && (
                                        <section key={sec.l}>
                                            <h2 className={`font-black text-lg italic border-l-[6px] pl-4 uppercase tracking-tighter mb-6 ${sec.clr === 'blue' ? 'text-blue-600 border-blue-600' : sec.clr === 'amber' ? 'text-amber-500 border-amber-500' : 'text-slate-600 border-slate-800'}`}>{sec.l} <span className="text-slate-500 text-xs not-italic ml-1">({sec.c.length})</span></h2>
                                            {sec.c.map(s => <Card key={s.id} s={s} update={updateJob} toggle={toggle} />)}
                                        </section>
                                    ))}
                                </div>
                            </>
                        ) : (
                            <div className="space-y-6">
                                <div className="flex items-center gap-3 mb-8"><Icon name="bar-chart-3" className="text-blue-600" /><h2 className="text-2xl font-black italic uppercase tracking-tighter">Operasyon ArÅŸivi</h2></div>
                                {archive.length ? archive.map(s => (
                                    <div key={s.id} className="glass-card p-4 rounded-3xl flex justify-between border-white/5">
                                        <div><p className="font-black uppercase text-sm">{s.name}</p><p className="text-[9px] font-bold text-slate-600 uppercase">{s.mahalle} â€¢ {new Date(s.createdAt).toLocaleDateString()}</p></div>
                                        <div className="text-right text-blue-500 font-black text-lg">{stats([s]).prime} â‚º</div>
                                    </div>
                                )) : <div className="text-center py-24 opacity-10 font-black italic">ArÅŸiv BoÅŸ</div>}
                            </div>
                        )}
                    </main>
                    <div className="safe-area-bottom h-12"></div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>